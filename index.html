<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castlevania</title>

    <!-- CSS -->
    <style>
        *, *::before, *::after {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            -ms-box-sizing: border-box;
            box-sizing: border-box;
        }

        body, 
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            position: relative;
            background-image: url('./assets/Background/background_castle_no_fog.png');
            background-size: cover;
        }

        canvas {
            filter: blur(1px);
            image-rendering: -moz-crisp-edges;    /* Firefox */
            image-rendering: -webkit-crisp-edges; /* Webkit (Safari) */
            image-rendering: pixelated;           /* Chrome */
        }


        /* Start over the images */
        .fade-in {
            background: rgb(0, 0, 0, 1);
            z-index: 3;
            animation: fadeIn;
            animation-duration: 20s;
            animation-iteration-count: 1;
            animation-fill-mode: forwards;
        }

        @keyframes fadeIn {
            0% {
                background: rgb(0, 0, 0, 1);
            }
            100% {
                background: rgb(0, 0, 0, 0);
            }
        }


        /* Fog animation */
        .fog-apear {
            animation: fogApear 9s forwards;
            animation-iteration-count: 1;
            animation-timing-function: ease-in;
        }

        .fog-anim {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 2;
            left: 0;
            top: 0;
            opacity: 0.3;
            background: url("./assets/Background/fog.png") repeat-x;
            background-size: 60% auto;
            background-position: 0 bottom;
            animation: fogAnim 55s;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            animation-direction: normal;   
        }

        @keyframes fogAnim {
            0% {
                background-position: -200% bottom;
            }
            100% {
                background-position: 0% bottom;
            }
        }

        @keyframes fogApear {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
    </style>
    
    <!-- ICON -->
    <link rel="shortcut icon" href="./assets/HUD/weapon_icon.png">

</head>

<body class="fade-in">
    <canvas id="canvas"></canvas>
    <div class="fog-apear">
		<div class="fog-anim"></div>
	</div>

    <script type="text/javascript">
        let c = init('canvas');
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;

        //// initiation
        let scale = 1.4;
        let number = 200;

        class Firefly {
            constructor() {
                this.x = Math.random() * w;
                this.y = Math.random() * h;
                this.ang = Math.random() * 2 * Math.PI;
                this.s = Math.random() * 2 * scale;
                this.v = (this.s * this.s) / 4;
            }
            move() {
                this.x += this.v * Math.cos(this.ang);
                this.y += this.v * Math.sin(this.ang);
                this.and += (Math.random() * 20 * Math.PI) / 180 - (10 * Math.PI) / 180;
            }
            show() {
                c.beginPath();
                c.arc(this.x, this.y, this.s, 0, 2 * Math.PI);
                c.fillStyle = '#c06228';
                c.fill();
            }
        }

        let fireflies = [];

        function draw() {
            if (fireflies.length < number) {
                for (let j = 0; j < 10; j++) {
                    fireflies.push(new Firefly());
                }
            }

            //// animation
            for (let i = 0; i < fireflies.length; i++) {
                fireflies[i].move();
                fireflies[i].show();
                if (fireflies[i].x > w || fireflies[i].x < 0 || fireflies[i].y > h || fireflies[i].y < 0) {
                    fireflies.splice(i, 1);
                }
            }
        }

        let mouse = {};
        let last_mouse = {};

        canvas.addEventListener(
            "mouseover", 
            function (e) {
                last_mouse.x = mouse.x;
                last_mouse.y = mouse.y;

                mouse.x = e.pageX - this.offsetLeft;
                mouse.y = e.pageY - this.offsetTop;
            }, 
            false
        );

        function init(elemid) {
            let canvas = document.getElementById(elemid), 
                c = canvas.getContext('2d'), 
                w = (canvas.width = window.innerWidth), 
                h = (canvas.height = window.innerHeight);
            c.fillStyle = 'rgba(30, 30, 30, 1)';
            c.fillRect(0, 0, w, h);
            return c;
        };

        window.requestAnimationFrame = function () {
            return (
                window.requestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback);
                }
            );
        };

        function loop() {
            window.requestAnimationFrame(loop);
            c.clearRect(0, 0, w, h);
            draw();
        }
        window.addEventListener('resize', function () {
            (w = canvas.width = window.innerWidth), 
            (h = canvas.height = window.innerHeight);
            loop();
        });

        var delayInMilliseconds = 3500;

        setTimeout(function () {
            loop();
            setInterval(loop, 2600 / 60);
        }, delayInMilliseconds);

    </script>
</body>
</html>